import streamlit as st


def render_about_tab():
    """
    Рендерит вкладку "О приложении" с объяснениями.
    """
    st.header("О приложении")

    # Раздел 1: Общая информация
    st.markdown("""
    ## Описание

    Это приложение для распознавания рукописных математических выражений (Handwritten
    Mathematical Expression Recognition) с использованием модели **TrOCR** от Microsoft.

    Модель была дообучена на датасете **HME100K** (100,000 рукописных математических
    выражений) для повышения точности распознавания математической нотации.
    """)

    # Раздел 2: Принцип работы
    st.markdown("---")
    st.markdown("## Принцип работы")

    st.markdown("""
    ### Архитектура TrOCR

    TrOCR (Transformer-based Optical Character Recognition) - это модель, основанная
    на архитектуре Transformer:

    1. **Vision Encoder** (на базе ViT - Vision Transformer):
       - Разбивает изображение на патчи (patches)
       - Извлекает визуальные признаки

    2. **Text Decoder** (на базе GPT-2):
       - Декодирует визуальные признаки в последовательность LaTeX токенов
       - Использует beam search для генерации наиболее вероятной последовательности

    ### Процесс распознавания:

    1. **Предобработка**: Конвертация изображения в RGB (+ опциональная инверсия/бинаризация)
    2. **Кодирование**: Vision Encoder преобразует изображение в векторное представление
    3. **Декодирование**: Text Decoder генерирует LaTeX токены автоградиентно
    4. **Постобработка**: Конвертация токенов в финальную LaTeX строку
    """)

    # Раздел 3: Метрики
    st.markdown("---")
    st.markdown("## Метрики качества")

    col1, col2 = st.columns(2)

    with col1:
        st.markdown("""
        ### CER (Character Error Rate)

        **Определение**: Отношение количества ошибок (вставки, удаления, замены символов)
        к общей длине референсной строки.

        **Формула**:
        ```
        CER = Levenshtein Distance / len(reference)
        ```

        **Диапазон**: от 0 (идеально) до 1+ (больше ошибок, чем символов)

        **Пример**:
        - Предсказание: `x^2 + y`
        - Ground truth: `x^2 - y`
        - CER = 1/7 ≈ 0.14 (14%)
        """)

    with col2:
        st.markdown("""
        ### Edit Distance (Расстояние Левенштейна)

        **Определение**: Минимальное количество операций редактирования (вставка,
        удаление, замена символа) для преобразования одной строки в другую.

        **Пример**:
        - Предсказание: `\\frac{a}{b}`
        - Ground truth: `\\frac{c}{b}`
        - Edit Distance = 1 (замена 'a' на 'c')

        **Применение**: Показывает абсолютное количество ошибок (в отличие от CER,
        который нормализован на длину).
        """)

    st.markdown("""
    ### Expression Rate (ExpRate)

    **Определение**: Процент выражений, которые были распознаны **полностью корректно**
    (без единой ошибки).

    **Пример**: На 100 изображениях:
    - 58 распознаны точно → ExpRate = 58%
    - 42 распознаны с ошибками

    **Важность**: Показывает "идеальную" точность модели.
    """)

    # Раздел 4: Датасет
    st.markdown("---")
    st.markdown("## Датасет обучения")

    st.markdown("""
    **HME100K** (Handwritten Mathematical Expressions 100K):
    - 100,000+ рукописных математических выражений
    - LaTeX разметка для каждого изображения
    - Разнообразие стилей письма и сложности выражений
    - Включает: дроби, интегралы, суммы, греческие буквы, матрицы и др.
    """)

    # Раздел 5: Ссылки
    st.markdown("---")
    st.markdown("## Полезные ссылки")

    st.markdown("""
    - [TrOCR: Transformer-based Optical Character Recognition](https://huggingface.co/microsoft/trocr-base-handwritten)
    - [HME100K Dataset](https://github.com/MathWriting/HME100K)
    - [LaTeX Documentation](https://www.latex-project.org/help/documentation/)
    """)
